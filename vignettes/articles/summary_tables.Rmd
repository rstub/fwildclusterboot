---
title: "Summary Tables with `modelsummary`"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(fwildclusterboot)
library(modelsummary)
```

To produce publication ready tables with `fwildclusterboot` and the `modelsummary` package, there are two options: you can either work with objects of type `lm`, `fixest`, `felm` or `ivreg` and add bootstrap test statistics as custom rows, or you can work with objects of type `boottest`. In general, the first method is both more robust **and** more flexible and therefore recommended. 

## Regression tables based on objects of type `lm`, `fixest`, `felm` or `ivreg`

```{r, message=FALSE, warning = FALSE}
data(voters)

fit <- fixest::feols(proposition_vote ~ csw(treatment, ideology1) | csw(Q1_immigration, Q2_defense), cluster ~ group_id1, data = voters)
res <- lapply(fit, \(x) boottest(x, B = 999, param = "treatment", clustid = "group_id1"))  

library(tibble)
rows <- tribble(~term, ~ `Model 1`, ~`Model 2`, ~`Model 3`, ~`Model 4`, 
                'boottest p-value', res[[1]]$p_val, res[[2]]$p_val, res[[3]]$p_val, res[[4]]$p_val)

attr(rows, 'position') <- c(3)
msummary(fit, 
         estimate = "{estimate} ({p.value})", 
         statistic = "[{conf.low}, {conf.high}]", 
         add_rows = rows
)
```


## Regression tables based on objects of type `boottest`

```{r, message=FALSE, warning = FALSE}
fit <- fixest::feols(proposition_vote ~ csw(treatment, ideology1) | csw(Q1_immigration, Q2_defense), cluster ~ group_id1, data = voters)

res <- list()
for(x in seq_along(fit)){
  res[[x]] <- boottest(fit[[x]], B = 999, param = "treatment", clustid = "group_id1") 
}

msummary(res, 
         estimate = "{estimate} ({p.value})", 
         statistic = "[{conf.low}, {conf.high}]", 
)


```




