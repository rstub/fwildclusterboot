<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>fwildclusterboot • fwildclusterboot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="fwildclusterboot">
<meta property="og:description" content="fwildclusterboot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fwildclusterboot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/fwildclusterboot.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/s3alfisc/fwildclusterboot/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="fwildclusterboot_files/header-attrs-2.9/header-attrs.js"></script><script src="fwildclusterboot_files/kePrint-0.0.1/kePrint.js"></script><link href="fwildclusterboot_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>fwildclusterboot</h1>
                        <h4 class="author">Alexander Fischer</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/s3alfisc/fwildclusterboot/blob/master/vignettes/fwildclusterboot.Rmd"><code>vignettes/fwildclusterboot.Rmd</code></a></small>
      <div class="hidden name"><code>fwildclusterboot.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://s3alfisc.github.io/fwildclusterboot/">fwildclusterboot</a></span><span class="op">)</span></code></pre></div>
<p>The <code>fwildclusterboot</code> package is an R port of STATA’s <a href="https://github.com/droodman/boottest">boottest</a> package.</p>
<p>It implements the “fast” wild cluster bootstrap algorithm developed in Roodman et al (2019) for regression objects in R. The “fast” algorithm makes it feasible to calculate test statistics based on a large number of bootstrap draws even for large samples - as long as the number of bootstrapping clusters is not too large.</p>
<p>A description of the algorithm is beyond the scope of this vignette. It is very clearly presented in <a href="https://econpapers.repec.org/paper/qedwpaper/1406.htm">Roodman et al. (2019)</a>. For technical details of the implementation in <code>fwildclusterboot</code>, have a look at the <code>technical vignette</code>.</p>
<p>For linear regression models, <code>fwildclusterboot</code> supports almost all features of <code>boottest</code>. This means that a set of different bootstrap distributions, regression weights, fixed effects, and both restricted (WCR) and unrestricted (WCU) boostrap inference are supported. The main difference is that it currently only supports univariate hypothesis tests of regression paramters of the form <span class="math inline">\(H_{0}: \beta_{k} = \beta_{k}^{0}\)</span> vs <span class="math inline">\(H_{1}: \beta_{k} \neq \beta_{k}^{0}\)</span>.</p>
<p>In contrast to <code>boottest</code>, <code>fwildclusterboot</code> does not support methods for instrumental variable estimation and the score bootstrap for non-linear models.</p>
<div id="the-boottest-function" class="section level1">
<h1 class="hasAnchor">
<a href="#the-boottest-function" class="anchor"></a>The <code>boottest()</code> function</h1>
<p>The <code>fwildclusterboot</code> package consists of one key function, <code><a href="../reference/boottest.html">boottest()</a></code>. It implements the fast wild bootstrap and works with regression objects of type <code>lm</code>, <code>felm</code> and <code>fixest</code> from base R and the <code>lfe</code> and <code>fixest</code> packages.</p>
<p>To start, we create a random data set with two cluster variables (group_id1 &amp; group_id2), two fixed effects and a set of covariates. The <code>icc_</code> arguments control the cluster variable’s intra-cluster correlation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># load data set voters included in fwildclusterboot</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">voters</span><span class="op">)</span>

<span class="co"># estimate the regression model via lm</span>
<span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">proposition_vote</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">ideology1</span> <span class="op">+</span> <span class="va">log_income</span> <span class="op">+</span> <span class="va">Q1_immigration</span> , data <span class="op">=</span> <span class="va">voters</span><span class="op">)</span>

<span class="co"># model with interaction</span>
<span class="va">lm_fit_interact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">proposition_vote</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">ideology1</span> <span class="op">+</span> <span class="va">log_income</span><span class="op">:</span><span class="va">Q1_immigration</span> , data <span class="op">=</span> <span class="va">voters</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"fixest"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/">fixest</a></span><span class="op">)</span>
  <span class="co"># estimate the regression model via feols</span>
  <span class="va">feols_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html">feols</a></span><span class="op">(</span><span class="va">proposition_vote</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">ideology1</span> <span class="op">+</span> <span class="va">log_income</span> <span class="op">+</span> <span class="va">Q1_immigration</span> , data <span class="op">=</span> <span class="va">voters</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"lfe"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sgaure/lfe">lfe</a></span><span class="op">)</span>
  <span class="co"># estimate the regression model via felm</span>
  <span class="va">felm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html">felm</a></span><span class="op">(</span><span class="va">proposition_vote</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">ideology1</span> <span class="op">+</span> <span class="va">log_income</span> <span class="op">+</span> <span class="va">Q1_immigration</span> , data <span class="op">=</span> <span class="va">voters</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The <code><a href="../reference/boottest.html">boottest()</a></code> function has 4 required and several optional arguments. The required objects are</p>
<ul>
<li>object: a regression object of type <code>lm</code>, <code>fixest</code> or <code>felm</code>
</li>
<li>clustid: a character vector that defines the clustering variables</li>
<li>param: a character vector of length one - the model parameter to be tested</li>
<li>B: the number of bootstrap iterations</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># boottest on an object of type lm</span>
<span class="va">boot_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, clustid <span class="op">=</span> <span class="st">"group_id1"</span>, param <span class="op">=</span> <span class="st">"treatment"</span>, B <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"fixest"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># boottest on an object of type fixest</span>
  <span class="va">boot_feols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">feols_fit</span>, clustid <span class="op">=</span> <span class="st">"group_id1"</span>, param <span class="op">=</span> <span class="st">"treatment"</span>, B <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span>
<span class="op">}</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"lfe"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># boottest on an object of type felm</span>
  <span class="va">boot_felm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">felm_fit</span>, clustid <span class="op">=</span> <span class="st">"group_id1"</span>, param <span class="op">=</span> <span class="st">"treatment"</span>, B <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>To tests for an interaction, it is important to use the coefficient names that are internally created by the modeling function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lm_fit_interact</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  [1] "(Intercept)"                 "treatment"                  </span>
<span class="co">#&gt;  [3] "ideology1"                   "log_income:Q1_immigration1" </span>
<span class="co">#&gt;  [5] "log_income:Q1_immigration2"  "log_income:Q1_immigration3" </span>
<span class="co">#&gt;  [7] "log_income:Q1_immigration4"  "log_income:Q1_immigration5" </span>
<span class="co">#&gt;  [9] "log_income:Q1_immigration6"  "log_income:Q1_immigration7" </span>
<span class="co">#&gt; [11] "log_income:Q1_immigration8"  "log_income:Q1_immigration9" </span>
<span class="co">#&gt; [13] "log_income:Q1_immigration10"</span>
<span class="va">boot_lm_interact</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit_interact</span>, clustid <span class="op">=</span> <span class="st">"group_id1"</span>, param <span class="op">=</span> <span class="st">"log_income:Q1_immigration1"</span>, B <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span></code></pre></div>
<p>To access the estimation results, <code><a href="../reference/boottest.html">boottest()</a></code> comes with <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, <code>tidy()</code> and <code>glance()</code> methods. The <code>tidy()</code> method returns the estimation results in a data.frame. <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> returns additional information on top of the test statistics reported by <code>tidy()</code>. The<code>glance()</code> method enables the use of output formatting tools from the <code>modelsummary</code> package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fwildclusterboot's internal summary() method</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">boot_lm</span><span class="op">)</span>
<span class="co">#&gt; boottest.lm(object = lm_fit, clustid = "group_id1", param = "treatment", </span>
<span class="co">#&gt;     B = 9999)</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  Observations: 300</span>
<span class="co">#&gt;  Bootstr. Iter: 9999</span>
<span class="co">#&gt;  Bootstr. Type: rademacher</span>
<span class="co">#&gt;  Clustering: 1-way</span>
<span class="co">#&gt;  Confidence Sets: 95%</span>
<span class="co">#&gt;  Number of Clusters: 40</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;        term estimate statistic p.value conf.low conf.high</span>
<span class="co">#&gt; 1 treatment    0.073     3.786   0.001    0.033     0.112</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"modelsummary"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># summary via the modelsummary package</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/modelsummary/">modelsummary</a></span><span class="op">)</span>
  <span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/msummary.html">msummary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">boot_lm</span>, <span class="va">boot_lm_interact</span><span class="op">)</span>, 
            estimate <span class="op">=</span> <span class="st">"{estimate} ({p.value})"</span>, 
           statistic <span class="op">=</span> <span class="st">"[{conf.low}, {conf.high}]"</span><span class="op">)</span>  
<span class="op">}</span>
<span class="co">#&gt; Loading required namespace: modelsummary</span></code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
treatment
</td>
<td style="text-align:center;">
0.073 (0.001)
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
[0.033, 0.112]
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
log_income × Q1_immigration1
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
-0.038 (0.001)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[-0.056, -0.019]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.339
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.311
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
-82.1
</td>
<td style="text-align:center;">
-92.2
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
-30.2
</td>
<td style="text-align:center;">
-40.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
60.102
</td>
</tr>
</tbody>
</table>
<p>A <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method allows the user to inspect the bootstrap t-statistics:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">boot_lm</span><span class="op">)</span></code></pre></div>
<p><img src="fwildclusterboot_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<!-- A note on the output in `tidy()` and `summary()`: -->
<div id="multiway-clustering" class="section level2">
<h2 class="hasAnchor">
<a href="#multiway-clustering" class="anchor"></a>Multiway Clustering</h2>
<p>The <code><a href="../reference/boottest.html">boottest()</a></code> function supports clustering of any dimension. E.g. for two-way clustering, one simply needs to specify the names of the cluster variables in a character vector.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"group_id2"</span><span class="op">)</span>, param <span class="op">=</span> <span class="st">"treatment"</span>, B <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">boot_lm</span><span class="op">)</span>
<span class="co">#&gt; boottest.lm(object = lm_fit, clustid = c("group_id1", "group_id2"), </span>
<span class="co">#&gt;     param = "treatment", B = 9999)</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  Observations: 300</span>
<span class="co">#&gt;  Bootstr. Iter: 9999</span>
<span class="co">#&gt;  Bootstr. Type: rademacher</span>
<span class="co">#&gt;  Clustering: 2-way</span>
<span class="co">#&gt;  Confidence Sets: 95%</span>
<span class="co">#&gt;  Number of Clusters: 40 20 251</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;        term estimate statistic p.value conf.low conf.high</span>
<span class="co">#&gt; 1 treatment    0.073     3.925   0.005     0.03     0.116</span></code></pre></div>
</div>
<div id="choice-of-bootstrap-weights" class="section level2">
<h2 class="hasAnchor">
<a href="#choice-of-bootstrap-weights" class="anchor"></a>Choice of Bootstrap Weights</h2>
<p>Furthermore, the user can choose among four different weighting distribution via the <code>type</code> argument: Rademacher, Mammen, Normal and Webb. By default, <code><a href="../reference/boottest.html">boottest()</a></code> uses the Rademacher distribution.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_lm_rade</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, 
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"group_id2"</span><span class="op">)</span>, 
                    param <span class="op">=</span> <span class="st">"treatment"</span>, 
                    B <span class="op">=</span> <span class="fl">999</span>,
                    type <span class="op">=</span> <span class="st">"rademacher"</span><span class="op">)</span>
<span class="va">boot_lm_webb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, 
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"group_id2"</span><span class="op">)</span>, 
                    param <span class="op">=</span> <span class="st">"treatment"</span>, 
                    B <span class="op">=</span> <span class="fl">999</span>,
                    type <span class="op">=</span> <span class="st">"webb"</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"modelsummary"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/modelsummary/">modelsummary</a></span><span class="op">)</span>
  <span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/msummary.html">msummary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">boot_lm_rade</span>, <span class="va">boot_lm_webb</span><span class="op">)</span>, 
          estimate <span class="op">=</span> <span class="st">"{estimate} ({p.value})"</span>, 
         statistic <span class="op">=</span> <span class="st">"[{conf.low}, {conf.high}]"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
treatment
</td>
<td style="text-align:center;">
0.073 (0.007)
</td>
<td style="text-align:center;">
0.073 (0.003)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.027, 0.116]
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.028, 0.117]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
-82.1
</td>
<td style="text-align:center;">
-82.1
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
-30.2
</td>
<td style="text-align:center;">
-30.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
55.025
</td>
</tr>
</tbody>
</table>
</div>
<div id="other-function-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#other-function-arguments" class="anchor"></a>Other function arguments</h2>
<p>Via the function argument <code>sign_level</code>, the user can control the significance level of the test. The default value is sign_level = 0.05, which corresponds to a 95% confindence interval.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_lm_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, 
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span><span class="op">)</span>,
                    param <span class="op">=</span> <span class="st">"treatment"</span>, B <span class="op">=</span> <span class="fl">9999</span>, 
                    sign_level <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="va">boot_lm_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, 
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span><span class="op">)</span>,
                    param <span class="op">=</span> <span class="st">"treatment"</span>, B <span class="op">=</span> <span class="fl">9999</span>, 
                    sign_level <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"modelsummary"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/modelsummary/">modelsummary</a></span><span class="op">)</span>
  <span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/msummary.html">msummary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">boot_lm_5</span>, <span class="va">boot_lm_10</span><span class="op">)</span>, 
          estimate <span class="op">=</span> <span class="st">"{estimate} ({p.value})"</span>, 
         statistic <span class="op">=</span> <span class="st">"[{conf.low}, {conf.high}]"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
treatment
</td>
<td style="text-align:center;">
0.073 (0.001)
</td>
<td style="text-align:center;">
0.073 (0.001)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.033, 0.112]
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.040, 0.106]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
-82.1
</td>
<td style="text-align:center;">
-82.1
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
-30.2
</td>
<td style="text-align:center;">
-30.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
55.025
</td>
</tr>
</tbody>
</table>
<p>In the case of multiway clustering, the user might want to specify the bootstrap clustering level. By default, boottest chooses the clustering level with the highest number of clusters as <code>bootcluster = "max"</code>. Other choices are the minimum cluster, or independent clustering variables.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_lm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, 
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"group_id2"</span><span class="op">)</span>, 
                    param <span class="op">=</span> <span class="st">"treatment"</span>,
                    B <span class="op">=</span> <span class="fl">9999</span>, 
                    bootcluster <span class="op">=</span> <span class="st">"min"</span><span class="op">)</span>

<span class="va">boot_lm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, 
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"group_id2"</span><span class="op">)</span>, 
                    param <span class="op">=</span> <span class="st">"treatment"</span>,
                    B <span class="op">=</span> <span class="fl">9999</span>, 
                    bootcluster <span class="op">=</span> <span class="st">"group_id1"</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"modelsummary"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/modelsummary/">modelsummary</a></span><span class="op">)</span>
  <span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/msummary.html">msummary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">boot_lm1</span>, <span class="va">boot_lm2</span><span class="op">)</span>, 
          estimate <span class="op">=</span> <span class="st">"{estimate} ({p.value})"</span>, 
         statistic <span class="op">=</span> <span class="st">"[{conf.low}, {conf.high}]"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
treatment
</td>
<td style="text-align:center;">
0.073 (0.005)
</td>
<td style="text-align:center;">
0.073 (0.010)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.032, 0.111]
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.029, 0.116]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
-82.1
</td>
<td style="text-align:center;">
-82.1
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
-30.2
</td>
<td style="text-align:center;">
-30.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
55.025
</td>
</tr>
</tbody>
</table>
</div>
<div id="fixed-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#fixed-effects" class="anchor"></a>Fixed Effects</h2>
<p>Last, <code><a href="../reference/boottest.html">boottest()</a></code> supports out-projection of fixed effects in the estimation stage via <code><a href="https://rdrr.io/pkg/lfe/man/felm.html">lfe::felm()</a></code> and <code><a href="https://lrberge.github.io/fixest/reference/feols.html">fixest::feols()</a></code>. Within the bootstrap, the user can choose to project out <em>only one</em> fixed effect, which can be set via the <code>fe</code> function argument. All other fixed effects specified in either <code><a href="https://rdrr.io/pkg/lfe/man/felm.html">felm()</a></code> or <code><a href="https://lrberge.github.io/fixest/reference/feols.html">feols()</a></code> are treated as sets of binary regressors.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"fixest"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># estimate the regression model via feols</span>
  <span class="va">feols_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html">feols</a></span><span class="op">(</span><span class="va">proposition_vote</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">ideology1</span> <span class="op">+</span> <span class="va">log_income</span> <span class="op">|</span> <span class="va">Q1_immigration</span> , data <span class="op">=</span> <span class="va">voters</span><span class="op">)</span>
  <span class="va">boot_feols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">feols_fit</span>, 
                         clustid <span class="op">=</span> <span class="st">"group_id1"</span>, 
                         param <span class="op">=</span> <span class="st">"treatment"</span>, 
                         B <span class="op">=</span> <span class="fl">9999</span>, 
                         fe <span class="op">=</span> <span class="st">"Q1_immigration"</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"lfe"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># estimate the regression model via felm</span>
  <span class="va">felm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html">felm</a></span><span class="op">(</span><span class="va">proposition_vote</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">ideology1</span> <span class="op">+</span> <span class="va">log_income</span> <span class="op">|</span> <span class="va">Q1_immigration</span> , data <span class="op">=</span> <span class="va">voters</span><span class="op">)</span>
  <span class="va">boot_felm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">felm_fit</span>, 
                        clustid <span class="op">=</span> <span class="st">"group_id1"</span>,
                        param <span class="op">=</span> <span class="st">"treatment"</span>, 
                        B <span class="op">=</span> <span class="fl">9999</span>, 
                        fe <span class="op">=</span> <span class="st">"Q1_immigration"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="the-subcluster-bootstrap" class="section level2">
<h2 class="hasAnchor">
<a href="#the-subcluster-bootstrap" class="anchor"></a>The Subcluster Bootstrap</h2>
<p>In the case of few treated clusters, <a href="https://academic.oup.com/ectj/article-abstract/21/2/114/5078969">MacKinnon and Webb (2018)</a> suggest to use subclusters to form the bootstrap distribution. <code><a href="../reference/boottest.html">boottest()</a></code> allows the user to specify subclusters via the <code>bootcluster</code> argument.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>,
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"group_id2"</span><span class="op">)</span>, 
                    param <span class="op">=</span> <span class="st">"treatment"</span>, 
                    B <span class="op">=</span> <span class="fl">9999</span>, 
                    bootcluster <span class="op">=</span> <span class="st">"min"</span><span class="op">)</span>
<span class="va">boot_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>,
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"group_id2"</span><span class="op">)</span>, 
                    param <span class="op">=</span> <span class="st">"treatment"</span>, 
                    B <span class="op">=</span> <span class="fl">9999</span>, 
                    bootcluster <span class="op">=</span> <span class="st">"group_id1"</span><span class="op">)</span>
<span class="va">boot_2var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>,
                    clustid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"group_id2"</span><span class="op">)</span>, 
                    param <span class="op">=</span> <span class="st">"treatment"</span>, 
                    B <span class="op">=</span> <span class="fl">9999</span>, 
                    bootcluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group_id1"</span>, <span class="st">"Q1_immigration"</span><span class="op">)</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"modelsummary"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/modelsummary/">modelsummary</a></span><span class="op">)</span>
  <span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/msummary.html">msummary</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">boot_min</span>, <span class="va">boot_2var</span><span class="op">)</span>, 
         estimate <span class="op">=</span> <span class="st">"{estimate} ({p.value})"</span>, 
         statistic <span class="op">=</span> <span class="st">"[{conf.low}, {conf.high}]"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
treatment
</td>
<td style="text-align:center;">
0.073 (0.005)
</td>
<td style="text-align:center;">
0.073 (0.009)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.032, 0.111]
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.028, 0.117]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
-82.1
</td>
<td style="text-align:center;">
-82.1
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
-30.2
</td>
<td style="text-align:center;">
-30.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
55.025
</td>
</tr>
</tbody>
</table>
</div>
<div id="regression-weights-weighted-least-squares-wls" class="section level2">
<h2 class="hasAnchor">
<a href="#regression-weights-weighted-least-squares-wls" class="anchor"></a>Regression Weights / Weighted Least Squares (WLS)</h2>
<p>If regression weights are specified in the estimation stage via <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://lrberge.github.io/fixest/reference/feols.html">feols()</a></code> or <code><a href="https://rdrr.io/pkg/lfe/man/felm.html">felm()</a></code>, <code><a href="../reference/boottest.html">boottest()</a></code> incorporates the weights into the bootstrap inference:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># regression with weights / WLS</span>
<span class="va">lm_w_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/feols.html">feols</a></span><span class="op">(</span><span class="va">proposition_vote</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">ideology1</span> <span class="op">+</span> <span class="va">log_income</span>, weights <span class="op">=</span> <span class="va">voters</span><span class="op">$</span><span class="va">weights</span>, data <span class="op">=</span> <span class="va">voters</span><span class="op">)</span>

<span class="va">boot_feols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_w_fit</span>, 
                       clustid <span class="op">=</span> <span class="st">"group_id1"</span>, 
                       param <span class="op">=</span> <span class="st">"treatment"</span>, 
                       B <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span></code></pre></div>
</div>
<div id="parallel-execution" class="section level2">
<h2 class="hasAnchor">
<a href="#parallel-execution" class="anchor"></a>Parallel Execution</h2>
<p>A major bottleneck for the performance of <code><a href="../reference/boottest.html">boottest()</a></code> is a large matrix multiplication, which includes the bootstrap weights matrix on the right. In order to speed up the computation, this multiplication calls the c++ Eigen library, which allows for parallelization of dense matrix products. By default, <code><a href="../reference/boottest.html">boottest()</a></code> uses one thread. Note that there is a cost of parallelization due to communication overhead. As a rule of thumb, if <code><a href="../reference/boottest.html">boottest()</a></code> takes more than 10 seconds per execution, using a second thread might speed up the bootstrap.</p>
<p>The number of threads can be specified via the <code>nthreads</code> argument of <code><a href="../reference/boottest.html">boottest()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boot_feols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boottest.html">boottest</a></span><span class="op">(</span><span class="va">lm_fit</span>, 
                       clustid <span class="op">=</span> <span class="st">"group_id1"</span>, 
                       param <span class="op">=</span> <span class="st">"treatment"</span>, 
                       B <span class="op">=</span> <span class="fl">9999</span>, 
                       nthreads <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="miscellanea" class="section level1">
<h1 class="hasAnchor">
<a href="#miscellanea" class="anchor"></a>Miscellanea</h1>
<!-- ## Why does `boottest()` not compute standard errors? -->
<!-- ## A note on performance -->
<!-- ## Inversion of p-values -->
<!-- ### How it works: make use of linearity of both the numerator and J -->
<!-- The starting point of this section are equations (56, 58 and 62) in Roodman et al. They show that once can write the numerator as (eq. 56) -->
<!-- $$ -->
<!--   R(\hat{\beta}^{*} - \tilde{\beta}) = \{S_{c_{*}} [WDXAR' :* \tilde{u}] \}' v^{*}. -->
<!-- $$ -->
<!-- The denominator can be written as (eq. 60) -->
<!-- $$ -->
<!-- $$ -->
<!-- where the object $K$ can be computed as  -->
<!-- $$ -->
<!-- $$ -->
<!-- For univariate hypotheses, both numerator and J are linear in $beta0$.  -->
<!-- Note that several objects used in the computation of both numerator and J can be written as $\ü :* A$ or $\ü * A$, where $A$ is and $ü$ is .... All derivations are shown for the first case, while the main conclusions apply to the second as well.  -->
<!-- First, for the WCU, it holds that  -->
<!-- \begin{align} -->
<!--     \ü :* A &= (Y - X'\beta) :* A \\ -->
<!--       &= Y :* A - X'\beta :* A \\ -->
<!--       &= Y :* A - X'(X'X)^{-1}X Y :* A \\ -->
<!--       &=  ((1 :- P_{x}) Y) :* A  -->
<!-- \end{align} -->
<!-- For the WCR, the analogous derivation are slightly more complicated:  -->
<!-- \begin{align} -->
<!--   \tilde{u} :* A &= (Y_{r} - X_{r}'\beta_{r}) :* A \\ -->
<!--           &= Y_{r} :* A - X_{r}'\beta_{r} :* A \\ -->
<!--           &= Y_{r} :* A - X_{r}'(X_{r}'X_{r})^{-1}X_{r} Y_{r} :* A \\ -->
<!--           &= Y_{r} :* A - P_{xr} Y_{r} :* A \\ -->
<!-- \end{align} -->
<!-- Now, note that $Y_r = Y - X_0 r$, it follows that  -->
<!-- \begin{align} -->
<!--   \tilde{u} :* A &= Y_{r} :* A - P_{xr} Y_{r} :* A \\  -->
<!--             &= (Y - X_{0} r) :* A - P_{xr} (Y - X_{0} r) :* A \\ -->
<!--             &= Y :* A - X_{0} r :* A - (P_{xr} Y) :* A +  P_{xr}  X_{0} r :*A \\  -->
<!--             &=  Y :* A  - (P_{xr} Y) :* A - P_{xr}  X_{0} r :* A + X_{0} r :* A \\ -->
<!--             &= (Y - P_{xr} Y) :* A + (X_{0} r -P_{xr}  X_{0} r) :* A \\  -->
<!--             &= (1 :- P_{xr})Y :* A + ((1 :- P_{xr})  X_{0}) :* A * r \\ -->
<!--             &= P + Q r -->
<!-- \end{align} -->
<!-- where  -->
<!-- $$ -->
<!--   P = (1 :- P_{xr})Y -->
<!-- $$ -->
<!-- and  -->
<!-- $$ -->
<!--   Q = ((1 :- P_{xr})  X_{0}). -->
<!-- $$ -->
<!-- Both quantities, $P$ and $Q$, are explicitely computed as such in the boot_algo2 function. Q summarizes all terms that vary in $r$, while P summarizes constant terms.  -->
<!-- Note that in the case of the WCU, $X_r = X$, $P_{xr} = P_{x}$, and $X_0$ is a vector of length N, containing zeros.  -->
<!-- Therefore, the following quantities need to be computed:  -->
<!-- + $X_r$ -->
<!-- + $P_{xr}$ -->
<!-- + $X_0$ -->
<!-- + several different object for $A$ -->
<!-- Based on these objects, one can e.g. compute -->
<!-- \begin{align} -->
<!-- S_{c, c*}[\tilde{u} :* A] &= S_{c, c*}[(1 :- P_{xr})Y :* A] + S_{c, c*}[((1 :- P_{xr})  X_{0}) :* A]  r \\ -->
<!-- &= P_{1} + Q_{1} r -->
<!-- \end{align} -->
<!-- For K, one can then write an expression of the form  -->
<!-- \begin{align} -->
<!--   K &= (P_1 + P_2 + P_3) + (Q_1 + Q_2 +   Q_3) r  -->
<!-- \end{align} -->
<!-- For $J$, it follows that  -->
<!-- \begin{align} -->
<!--   J = K v & = (P_1 + P_2 + P_3) v + (Q_1 + Q_2 +   Q_3) v \times r \\ -->
<!--   &= C + D \times r -->
<!-- \end{align} -->
<!-- For $J :* J$, it hence follows  -->
<!-- $$ -->
<!--   J :* J = C :* C  + 2 C :* D \times r + D :* D \times r^{2} -->
<!-- $$ -->
<!-- So, in short: one can simply compute C, D, CC, CD and DD once and then invert the p-value by searching over beta0.  -->
<!-- Again, note that for for the WCU, $X_0 = 0$, which implies that in the equations above, all elements in $Q$, $Q1$, $Q2$, $Q3$, $D$, $CD$ and $DD$ are zero. In consequence, for the WCU, the numerator can be computed as  -->
<!-- $$ -->
<!-- $$ -->
<!-- and the denominator is  -->
<!-- $$ -->
<!-- $$ -->
<!-- For the WCU, both numerator and denominator do not depend on $r$. -->
<!-- + why might confidence intervals differ for estimates based on `lm()`, `feols()` and `felm()`? -->
<div id="small-sample-corrections" class="section level2">
<h2 class="hasAnchor">
<a href="#small-sample-corrections" class="anchor"></a>Small Sample Corrections</h2>
<p><code><a href="../reference/boottest.html">boottest()</a></code> applies the small-sample correction <span class="math inline">\(N_{g} / (N_{g} - 1)\)</span>, where <span class="math inline">\(N_g\)</span> is the dimension of cluster g.</p>
</div>
<div id="treatment-of-invalid-test-statistics-for-multiway-clustering" class="section level2">
<h2 class="hasAnchor">
<a href="#treatment-of-invalid-test-statistics-for-multiway-clustering" class="anchor"></a>Treatment of Invalid Test Statistics for multiway clustering</h2>
<p>In case of multi-way clustering, it is not guaranteed that the covariance matrix is positive definite, in which case the resulting bootstrap test statistics are invalid. <code><a href="../reference/boottest.html">boottest()</a></code> follows the implementation in STATA and deletes invalid tests statistics, and informs the user with a note.</p>
</div>
<div id="on-the-handling-of-missing-values" class="section level2">
<h2 class="hasAnchor">
<a href="#on-the-handling-of-missing-values" class="anchor"></a>On the handling of missing values</h2>
<p><code><a href="../reference/boottest.html">boottest()</a></code> retrieves both the design matrix <span class="math inline">\(X\)</span>, the dependent variable <span class="math inline">\(y\)</span> and the cluster variables from the input object of type <code>lm</code>, <code>fixest</code> or <code>felm</code>. Because <code><a href="../reference/boottest.html">boottest()</a></code> allows to add or delete clustering variables that are not employed in <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://lrberge.github.io/fixest/reference/feols.html">feols()</a></code> and <code><a href="https://rdrr.io/pkg/lfe/man/felm.html">felm()</a></code>, it may occur that a cluster variable is added in <code><a href="../reference/boottest.html">boottest()</a></code> that is not included in the regression model, either as a cluster variable or covariate.</p>
<p>In this case, boottest by default deletes the respective rows in the dependent variable, design matrix and in the cluster variables. In consequence, estimation (in the modeling step) and inference (via <code><a href="../reference/boottest.html">boottest()</a></code>) are done on a different sample. <code><a href="../reference/boottest.html">boottest()</a></code> returns a warning.</p>
<p>This in turn has a consequence for the use of <code><a href="../reference/boottest.html">boottest()</a></code> and <code>modelsummary</code>. <code><a href="../reference/boottest.html">boottest()</a></code> simply calls the <code>glance()</code> methods for objects of types <code>fixest</code>, <code>felm</code> and <code>lm</code> from the <code>broom</code> package, and therefore, the number of observations reported via <code><a href="https://vincentarelbundock.github.io/modelsummary/reference/msummary.html">msummary()</a></code> is the number of observations used in the modeling stage.</p>
<p>The default behavior of <code><a href="../reference/boottest.html">boottest()</a></code> - to delete missings with a warning - can be set off via the <code>na_omit</code> function argument. If <code>na_omit</code> is set to FALSE, <code><a href="../reference/boottest.html">boottest()</a></code> will not allow for missing values in the added cluster variables and throw an error.</p>
</div>
<div id="a-note-of-caution" class="section level2">
<h2 class="hasAnchor">
<a href="#a-note-of-caution" class="anchor"></a>A note of caution</h2>
<p>The <code><a href="https://lrberge.github.io/fixest/reference/feols.html">feols()</a></code> function from <code>fixest</code> introduces several useful formula shortcuts. E.g. one can fit several regressions at once. All these advanced formula tools are not supported in <code><a href="../reference/boottest.html">boottest()</a></code>. <code><a href="../reference/boottest.html">boottest()</a></code> tries to catch any use of advanced formulas, but might fail to return errors in some cases.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexander Fischer, David Roodman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
